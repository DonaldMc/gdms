{{left_sidebar_enabled,right_sidebar_enabled=True,False}}
{{extend 'layout.html'}}

{{if quest['qtype'] != 'action':}}
<h1>Question</h1>
<p>{{=MARKMIN(quest['questiontext'])}}</p>

<h2>Answers</h2>
{{if quest['status'] == 'Resolved':}}
<p>Users have resolved that the correct answer is: </p>
<p>{{=quest['correctanstext']}}</p>
{{pass}}
<p>{{=viewtext}}</p>
<p>The analysis of all answers is shown below.  <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onClick="parent.location='{{=URL('useranswers',args=[quest['id']])}}'" VALUE="Details"></p>

<div id='chartdiv'>
</div>
</div>
<table id='TabAnswers'>
				<thead>
					<tr>
						<th></th>
                        {{for item in lstanswers:}}
                        <th>{{=item}}</th>
                        {{pass}}
                    </tr>
                </thead>
                    <tbody>
                    <tr>
                        <th></th>
                        {{for item in lstnumanswers:}}
                        <td>{{=item}}</td>
                        {{pass}}
                    </tr>
                    </tbody>
                </table>


<p>This question has been answered {{=quest['totanswers']}} times. {{=numpass}} users passed on this question.  The current category is {{=quest['category']}}.</p>

{{if quest['status'] == 'Resolved':}}
{{if quest['answerreasons'] <> '':}}
<h2>Reasons</h2>
{{=MARKMIN(quest['answerreasons'])}}
{{=MARKMIN(quest['answerreason2'])}}
{{=MARKMIN(quest['answerreason3'])}}
{{pass}}

<p>This question is resolved - if you think the answer is wrong you may wish to challenge </p>
<h2>Challenge</h2>
<p><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onclick="ajax('{{=URL('viewquest','challenge',args=quest['id'])}}', ['challreason'], 'target')" VALUE="Challenge"> Reason: <input type="text" name="challreason" value="Enter reason for challenge" onfocus="if($(this).val() == 'Enter reason for challenge') $(this).val('')" onblur="if($(this).val() == '') $(this).val('Enter reason for challenge')"></p>
<p><INPUT TYPE=BUTTON class="btn btn-primary btn-sm btn-group-sm" onclick="ajax('{{=URL('viewquest','agree',args=[quest['id'],1])}}', ['quest'], 'target')" VALUE="Agree">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="ajax('{{=URL('viewquest','agree',args=[quest['id'],0])}}', ['quest'], 'target')" VALUE="Disagree">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onClick="parent.location='{{=URL('answer','get_question',args=['quest'])}}'" VALUE="Next Question">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="parent.location='{{=URL('submit','new_question',args=['action',quest['id']])}}'" VALUE="Linked Action">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="parent.location='{{=URL('submit','new_question',args=['quest',quest['id']])}}'" VALUE="Link Question"></p>

{{else:}}
<h2>Status</h2>
<p>{{=viewtext}}</p>
<p>This question is currently {{=quest['status']}}.  You don't have the option to challenge or agree and disagree at present because there is no resolved answer. </p>
<p><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onClick="parent.location='{{=URL('answer','get_question',args=['quest'])}}'" VALUE="Next Question"><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onclick="parent.location='{{=URL('submit','new_question',args=['action',quest['id']])}}'" VALUE="Linked Action"><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onclick="parent.location='{{=URL('submit','new_question',args=['quest',quest['id']])}}'" VALUE="Linked Question"></p>

{{pass}}

{{else:}}
<h1>Action</h1>
<p>{{=MARKMIN(quest['questiontext'])}}</p>

<h2>Status   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onClick="parent.location='{{=URL('useranswers',args=[quest['id']])}}'" VALUE="Details"></h2>
{{if quest['status'] != 'In Progress':}}
<p>This action is {{=quest['status']}} - if you think this is incorrect you may wish to challenge, you can also register your agreement or disagreement if you have not already done so.</p>

<h2>Challenge </h2>
<p><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm" onclick="ajax('{{=URL('viewquest','challenge',args=quest['id'])}}', ['challreason'], 'target')" VALUE="Challenge"> Reason: <input id="challreason" name="challreason" type="text"  value="Enter reason for challenge" onfocus="if($(this).val() == 'Enter reason for challenge') $(this).val('')" onblur="if($(this).val() == '') $(this).val('Enter reason for challenge')" ></p>
 
{{else:}}

<p>This action is not yet agreed so you don't have the option to challenge at present. You can either go to the next action directly or register your agreement and assessment of the urgency and importance of the action by clicking on the appropriate buttons. </p>

{{pass}}
<p>{{=TAG.INPUT(_TYPE='BUTTON',_class="btn btn-primary  btn-sm btn-group-sm", _onclick=XML("ajax('{{=URL('viewquest','agree',args=[quest['id'],0])}}', ['quest'], 'target')")), _VALUE="Disagree")}} this was the inerted tag does it work</p>

<p><INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="ajax('{{=URL('viewquest','agree',args=[quest['id'],1])}}', ['quest'], 'target')" VALUE="Agree">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="ajax('{{=URL('viewquest','agree',args=[quest['id'],0])}}', ['quest'], 'target')" VALUE="Disagree">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onClick="parent.location='{{=URL('answer','get_question',args=['action'])}}'" VALUE="Next Action">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onClick="parent.location='{{=URL('submit','new_question',args=['action'])}}'" VALUE="Create Action">
   <INPUT TYPE=BUTTON class="btn btn-primary  btn-sm btn-group-sm" onclick="parent.location='{{=URL('submit','new_question',args=['action',quest['id']])}}'" VALUE="Linked Action"></p>

{{pass}}


<div id="target"></div>

<h2>Urgency and importance</h2>

{{if quest['qtype'] != 'action':}}
{{if uqanswered:}}
<p>Here is how you and other people have rated the urgency and importance of the question so far.</p>
<table id='TabUrgency' class="table table-bordered table-condensed">
				<thead>
					<tr>
						<th></th>
                        <th>Urgency</th>
                        <th>Importance</th>
                    </tr>
                </thead>
                    <tbody>
                    <tr>
                        <th>Overall</th>
                        <td><input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=quest['urgency']}}" step="1" disabled /></td>
                        <td><input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=quest['importance']}}" step="1" disabled/></td>
                    </tr>
                    <tr>
                        <th>You</th>
                        <td><input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=uqurg}}" step="1" disabled /></td>
                        <td><input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=uqimp}}" step="1" disabled/></td>
                    </tr>
                    </tbody>
                </table>

{{else:}}
<p>Here is how other people rated the urgency and importance of this question. </p>
<table id='TabUrgency' class="table table-bordered table-condensed">
				<thead>
					<tr>
						<th></th>
                        <th>Urgency</th>
                        <th>Importance</th>
                    </tr>
                </thead>
                    <tbody>
                    <tr>
                        <th>Overall</th>
                        <td>0 <input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=quest['urgency']}}" step="1" disabled /> 10</td>
                        <td>0 <input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=quest['importance']}}" step="1" disabled/> 10</td>
                    </tr>
                    </tbody>
                </table>
{{pass}}
{{else:}}
{{if uqanswered:}}
<p>Here is how you and other people have rated the urgency and importance of the action so far.  You can adjust your assessment and resubmit as often as you like but only your latest opinion counts in the overall assessment.</p>
{{else:}}
<p>You haven't rated this action yet - other people rated it as follows. Please record your assessment using the form below:</p>  
{{pass}}
<table id='TabUrgency' class="table table-bordered table-condensed" >
				<thead>
					<tr>
						<th width="10%"></thwidth></th>
                        <th width="40%">Urgency</th>
                        <th width="40%"> Importance</th>
                        <th width=="10%"></th>
                    </tr>
                </thead>
                    <tbody>
                    <tr>
                        <th>Overall</th>
                        <td><input id="urgslide" type = "range" name="urgslider"  min="0"    max="10" value="{{=quest['urgency']}}" step="1" disabled /></td>
                        <td><input id="urgslide" type = "range" name="impslider"  min="0"    max="10" value="{{=quest['importance']}}" step="1" disabled/></td>
                        <td></td>
                    </tr>
                    <tr>
                        <th>You</th>
                        <td><input id="urgslide2" type = "range" name="urgslider2"  min="0"    max="10" value="{{=uqurg}}" step="1"/></td>
                        <td><input id="impslide2" type = "range" name="impslider2"  min="0"    max="10" value="{{=uqimp}}" step="1"/></td>
                        <td><INPUT TYPE=BUTTON class="btn btn-primary btn-sm" onclick="ajax('{{=URL('viewquest','urgency',args=[quest['id']])}}', ['urgslider2', 'impslider2'], 'urgupdate')" VALUE="Update"></td>
                    </tr>
                    </tbody>
                </table>

<div id="urgupdate"></div>
    {{pass}}

<h2>Comments</h2>
<p class="forminline"><INPUT TYPE=BUTTON class="btn btn-primary btn-sm" onclick="parent.location='{{=URL('comments',args=[quest['id']])}}'" VALUE="View & Add Comments"></p>

{{block left_sidebar}}
{{include 'newleftside.html'}}

{{end}}

{{if auth.user <> None:}} 
{{if quest['qtype'] != 'action':}}

<script>

gvChartInit();
$(document).ready(function(){


   $('#TabAnswers').gvChart({
	chartType: 'PieChart',
        hidetable: false,
	gvSettings: {
		vAxis: {title: 'Answers'},
		hAxis: {title: ''},
		width: 600,
		height: 300
		}});  
});

</script>
{{pass}}
{{pass}}

<!--[if lt IE 9]><script  src="{{=URL('static','js/excanvas.min.js')}}"></script><![endif]-->
<script src="{{=URL('static','js/jquery.jqplot.js')}}"></script></script>

<link rel="stylesheet" type="text/css" href="{{=URL('static','css/jquery.jqplot.css')}}" />

<script src="{{=URL('static','js/jqplot.pieRenderer.min.js')}}"></script>

<script>

jQuery(document).ready(function(){
var data = [
    ['Correct', {{=auth.user.numcorrect}}], ['Wrong', {{=auth.user.numwrong}}],
    ['Passed', {{=auth.user.numpassed}}],
    ['In Progress', {{=auth.user.numquestions - auth.user.numcorrect - auth.user.numwrong - auth.user.numpassed}} ]
  ];
  var plot1 = jQuery.jqplot ('chartdiv', [data],
    {
      seriesDefaults: {
        // Make this a pie chart.
        renderer: jQuery.jqplot.PieRenderer,
        rendererOptions: {
          // Put data labels on the pie slices.
          // By default, labels show the percentage of the slice.
          showDataLabels: true
        }
      },

    seriesColors: ["#579575", "#4bb2c5", "#c5b47f", "#EAA228",  "#839557", "#958c12",
        "#953579", "#4b5de4", "#d8b83f", "#ff5800", "#0085cc"],  // colors that will
         // be assigned to the series.  If there are more series than colors, colors
         // will wrap around and start at the beginning again.

    title: 'Test',      // Title for the plot.  Can also be specified as an object like:

      grid: {
        background: '#f8f8f8'    // CSS color spec for background color of grid.
},
      legend: { show:true, location: 'e' }
    }
  );


});

</script>
