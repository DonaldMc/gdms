{{left_sidebar_enabled,right_sidebar_enabled=False,False}}
{{extend 'layoutgraph.html'}}
{{from jointjs2py import portangle,addobjects,newmetlink,initgraph}}
{{from ndsfunctions import truncquest}}
{{from ndspermt import get_event_buttons}}

{{include 'event/eventdetails.i'}}

    <div id="target"> {{=d3nodes}}</div>
    <div id="message"></div>
    <div id="graph">
        <h1> The graph area</h1>
    <div id="toolbox" class >
      <input type="file" id="hidden-file-upload"><input id="upload-input" type="image" title="upload graph" src="/nds/static/images/upload-icon.png" alt="upload graph">
        <input type="image" id="download-input" title="download graph" src="/nds/static/images/download-icon.png" alt="download graph">
        <input type="image" id="delete-graph" title="delete graph" src="/nds/static/images/trash-icon.png" alt="delete graph">
    </div>
    </div>



<div id="ajaxlink"></div>

<div id="map"></div>  


<p>{{=get_event_buttons(eventrow.id, eventrow.shared, eventrow.owner, auth.user_id, 'eventmap')}}</p>

{{include 'event/eventitems.i'}}



    <script>
        /*{"edges":*/

        var ajaxquesturl = '{{=URL('network','ajaxquest')}}?'
        /*var d3nodes  = [{"id":2,"title":"can I edit","x":230,"y":494},{"id":3,"title":"test","x":436,"y":309}]*/
        var d3nodes = {{=XML(d3nodes)}};
        var vieweventmap = true
        /*var d3edges = [];
        var d3edges = [{"source":2,"target":3}]
        var d3edges = [{"source":13,"target":14}]*/
        var d3edges = {{=XML(d3edges)}};

        d3edges.forEach(function(e, i){
              d3edges[i] = {source: d3nodes.filter(function(n){return n.serverid == e.source;})[0],
                          target: d3nodes.filter(function(n){return n.serverid == e.target;})[0]}});

        function requestLink(sourceId,targetId)
        {
        ajax('{{=URL('network','linkrequest')}}'+'/'+sourceId+'/'+targetId+'/', ['bla'], 'ajaxlink');
        };

        function deleteLink(sourceId,targetId)
        {
        ajax('{{=URL('network','linkrequest')}}'+'/'+sourceId+'/'+targetId+'/delete/', ['bla'], 'ajaxlink');
        };

        function moveElement(sourceId, sourceposx, sourceposy)
        {

        ajax('{{=URL('event','move')}}'+'/'+{{=eventrow.id}}+'/'+sourceId+'/'+sourceposx+'/'+sourceposy+'/', ['bla'], 'ajaxlink');
        };



        function out(m) {
        $('#message').html(m);
        };
    </script>

 




