{{left_sidebar_enabled,right_sidebar_enabled=False,False}}
{{extend 'layout.html'}}

{{=form}}

{{if 'Issue' in session.selection and 'Draft' in session.selection:}}
<h1>Draft Issues</h1>
<div id="issuedraft">
{{=LOAD('default','questload.load',args=['default','Issue'],vars=dict(selection='IM'),ajax=True,target="issuedraft")}}
</div>
{{pass}}

{{if 'Issue' in session.selection and 'Proposed' in session.selection:}}
<h1>Issues in Progress</h1>
<div id="issueprog">
{{=LOAD('default','questload.load',args=['default','Issue'],vars=dict(selection='IP'),ajax=True,target="issueprog")}}
</div>
{{pass}}

{{if 'Issue' in session.selection and 'Resolved' in session.selection:}}
<h1>Resolved Issues</h1>
<div id="issueresolved">
{{=LOAD('default','questload.load',args=['default','Issue'],vars=dict(selection='IP'),ajax=True,target="issueresolved")}}
</div>
{{pass}}

{{if 'Question' in session.selection and 'Draft' in session.selection:}}
<h1>Draft Questions</h1>
<div id="questdraft">
{{=LOAD('default','questload.load',vars=dict(selection='QM'),ajax=True,target="questdraft")}}
</div>
{{pass}}

{{if 'Question' in session.selection and 'Proposed' in session.selection:}}
<h1>Questions in Progress</h1>
<div id="questprog">
    <script>
$("#questprog").load("{{=URL('default', 'questload.load', vars=dict(selection='QP',items_per_page=50, sortby='ResDate'))}}","test", function() {
  $('#QP').DataTable();} );
</script>

</div>
{{pass}}

{{if 'Question' in session.selection and 'Resolved' in session.selection:}}
<h1>Resolved Questions</h1>
<div id="questresolved">
    <script>
$( "#questresolved" ).load("{{=URL('default', 'questload.load', vars=dict(selection='QR',items_per_page=50,sortby='ResDate'))}}","test", function() {
  $('#QR').DataTable();} );
</script>
</div>
{{pass}}

{{if 'Action' in session.selection and 'Draft' in session.selection:}}
<h1>Draft Actions</h1>
<div id="actiondraft">
{{=LOAD('default','questload.load',vars=dict(selection='AM'),ajax=True,target="actiondraft")}}
</div>
{{pass}}

{{if 'Action' in session.selection and 'Proposed' in session.selection:}}
    <h1>Proposed Actions</h1>
<div id="actionprog">
    <script>
$( "#actionprog" ).load("{{=URL('default', 'questload.load', args=['default'],vars=dict(selection='AP', items_per_page=50, query='home', sortby='ResDate'))}}","test", function() {
  $('#AP').DataTable();} );
</script>
</div>
{{pass}}

{{if 'Action' in session.selection and 'Resolved' in session.selection:}}
    <h1>Resolved Actions</h1>
<div id="actionresolved">
    <script>
$( "#actionresolved" ).load("{{=URL('default', 'questload.load', args=['default'],vars=dict(selection='AR', items_per_page=50, query='home', sortby='ResDate'))}}","test", function() {
  $('#AR').DataTable();} );
</script>
</div>

{{pass}}

<script>

/*
jQuery(function() {
  jQuery(document).ajaxComplete(function(e, xhr, settings) {

  console.log("Triggered ajaxSuccess handler." );

                 $('.issuetable2').DataTable();
  });
});

*/

function showcountryValue(newValue)
{
	document.getElementById("viewscope_country").value=newValue;
    $('#subdivopt').empty();
    ajax('{{=URL('submit','subdivn')}}', ['country'], 'subdivopt');
    document.getElementById("viewscope_subdivision").value="Unspecified";
}

function showsubdivValue(newValue)
{
	document.getElementById("viewscope_subdivision").value=newValue;
}

function loadissues(itemsperpage)
{
	web2py_component('/gdms/default/actionload.load?items_per_page=1','issueload');
}

$(document).ready(function(){



     $('#viewscope_country__row .w2p_fc').html('<select id="countryopt" name="countryopt" onchange="showcountryValue(this.value)"> <option value="{{=form.vars.country}}">{{=form.vars.country}}</option>   </select>');
   $('#viewscope_subdivision__row .w2p_fc').html('<select id="subdivopt" name="subdivopt" onchange="showsubdivValue(this.value)"> <option value="{{=form.vars.subdivision}}">{{=form.vars.subdivision}}</option> </select>');

    $('#viewscope_continent__row').hide();
    $('#viewscope_country__row .w2p_fw').hide();
    $('#viewscope_subdivision__row .w2p_fw').hide();



    if($("[id='scope1 Global']").prop('checked'))
            {$('#viewscope_continent__row').hide()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
    if($("[id='scope2 Continental']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
    if($("[id='scope3 National']").prop('checked'))
            {$('#viewscope_continent__row').show();
            $('#viewscope_country__row').show();
            $('#viewscope_country__row .w2p_fw').hide();
            $('#viewscope_subdivision__row').hide()};
     if($("[id='scope4 Local']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').show();
            $('#viewscope_country__row .w2p_fw').hide();
            $('#viewscope_subdivision__row').show();
            $('#viewscope_subdivision__row .w2p_fw').hide()};


    if ($('#filtersScope').prop('checked')==false){
       $('#viewscope_scope__row').hide();
       $('#viewscope_continent__row').hide();
       $('#viewscope_country__row').hide();
       $('#viewscope_subdivision__row').hide();}

    if ($('#filtersCategory').prop('checked')==false){
       $('#viewscope_category__row').hide();
        }

    if ($('#filtersAnswerGroup').prop('checked')==false){
       $('#viewscope_answer_group__row').hide();}


   $('#viewscope_showcat').change(function(){
           $('#TabAnswers').DataTable();
              $('#viewscope_category__row').toggle()});

    $('#filtersCategory').change(function(){
              $('#viewscope_category__row').toggle()
         $('#TabAnswers').DataTable();

         $('#TabIssues').DataTable();
           $('#TabActions').DataTable();

    });


        $('#filtersAnswerGroup').change(function(){
              $('#viewscope_answer_group__row').toggle()});



   $('#filtersScope').change(function(){
            if($('#filtersScope').prop('checked')==false) {
                $('#viewscope_scope__row').hide();
                $('#viewscope_continent__row').hide();
                $('#viewscope_country__row').hide();
                $('#viewscope_subdivision__row').hide();}
            else
                {$('#viewscope_scope__row').show();
            if($("[id='scope3 National']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').show()
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope1 Global']").prop('checked'))
            {$('#viewscope_continent__row').hide()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope2 Continental']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope4 Local']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').show()
            $('#viewscope_subdivision__row').show()};}

            });


   $('input[name=scope]').change(function(){
            if($("[id='scope1 Global']").prop('checked'))
            {$('#viewscope_continent__row').hide()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope2 Continental']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').hide()
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope3 National']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').show()
            $('#viewscope_country__row .w2p_fw').hide();
            $('#viewscope_subdivision__row').hide()};
            if($("[id='scope4 Local']").prop('checked'))
            {$('#viewscope_continent__row').show()
            $('#viewscope_country__row').show()
            $('#viewscope_country__row .w2p_fw').hide();
            $('#viewscope_subdivision__row').show()
            $('#viewscope_subdivision__row .w2p_fw').hide()};
            });

            $('#viewscope_continent ').change(function(){
            $('#countryopt').empty();
            ajax('{{=URL('submit','country')}}', ['continent'], 'countryopt');});

            $('#viewscope_country').change(function(){
            $('#subdivopt').empty();
            ajax('{{=URL('submit','subdivn')}}', ['country'], 'subdivopt');});



});

</script>






